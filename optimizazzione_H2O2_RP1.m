
%Problema di ottimizzazione
%indicherò con maiuscole le variabili e con minuscoli i vettori. Ad esempio
%Pc = variabile pc = vettore
%Ue = variabile ue = vettore

%% cancella
close all; clc; clear;

%% Dati da inserire 
%Inserisci da output:
%Mm = massa molare
%gamma 
%Pc = pressione in camera
%Tc = Temperatura in camera
%Is = impulso speecifico
%Rho = densità

is = [300 297];
ae_at = [20 30];
epsi = 1./ae_at;
pc = [70 100];
tc = [3000 3500];
rho = [0.025 0.05];
mm = [10 20];
gam = [1.2 1.3];
pe = [50 40];


%% funzioni
go = 9.81;
Ru = 8.31;
At = 9; %m2
Gam = 1.3;
Po = 1000; 
Epsi = 26.5;

%syms Mm Epsi Pe Pc Tc Is Rho 
%Rsig = @(Mm) Ru./Mm;

%Epsi = @(Pe,Pc) ((((Gam+1)/2)^(1/(Gam-1))).*(Pe./Pc).*sqrt((Gam+1)/(Gam-1).*(1-(Pe./Pc).^((Gam-1)/Gam)))); 
%Ue = @(Tc,Mm,Pe,Pc) sqrt(((2*Gam)/(Gam-1)).*Ru.*Tc./Mm.*(1-(Pe./Pc).^((Gam-1)/Gam)));
%Ae = @(Epsi,At) At.*Epsi;
%At = @(Epsi) 
%T = @(Pe,Epsi,At,Ue,Is) ((Pe-Po).*Epsi.*At)/(1-(Ue./(go.*Is)));
%Mpun = @(T,Is) T./(go.*Is);
%Mpun2 = @(Rho,Ue,Ae) Rho.*Ae.*Ue;

%% Tentativo 1

pe = finverse(epsi(x,pc),x)
ue = Ue(tc,mm,pe,pc)
son = Ae(epsi,at)
t = T(pe,epsi,at,ue,is)
mpun = Mpun(t,is)
mpun2 = Mpun2(rho,ue,son)

%% Data

Tc1 = [  2.9299*10^+03
  2.9409*10^+03
  2.9504*10^+03
  2.9587*10^+03
  2.9660*10^+03
  2.9726*10^+03
  2.9786*10^+03
  2.9841*10^+03
  2.9892*10^+03
  2.9938*10^+03
  2.9982*10^+03
  3.0023*10^+03
  3.0061*10^+03
  3.0097*10^+03
  3.0131*10^+03];
Tc2 = [  2.6864*10^+03
  2.6970*10^+03
  2.7061*10^+03
  2.7141*10^+03
  2.7211*10^+03
  2.7275*10^+03
  2.7333*10^+03
  2.7385*10^+03
  2.7434*10^+03
  2.7479*10^+03
  2.7521*10^+03
  2.7560*10^+03
  2.7597*10^+03
  2.7632*10^+03
  2.7664*10^+03];
Tc3 = [  1.1254*10^+03
  1.1326*10^+03
  1.1389*10^+03
  1.1443*10^+03
  1.1492*10^+03
  1.1536*10^+03
  1.1575*10^+03
  1.1612*10^+03
  1.1645*10^+03
  1.1676*10^+03
  1.1705*10^+03
  1.1733*10^+03
  1.1758*10^+03
  1.1782*10^+03
  1.1805*10^+03];

Is1 = [  1.0815*10^+03
  1.0831*10^+03
  1.0845*10^+03
  1.0857*10^+03
  1.0868*10^+03
  1.0878*10^+03
  1.0886*10^+03
  1.0894*10^+03
  1.0902*10^+03
  1.0908*10^+03
  1.0915*10^+03
  1.0921*10^+03
  1.0926*10^+03
  1.0931*10^+03
  1.0936*10^+03]./9.81;
Is2 = [  2.9813*10^+03
  2.9830*10^+03
  2.9844*10^+03
  2.9856*10^+03
  2.9866*10^+03
  2.9876*10^+03
  2.9884*10^+03
  2.9892*10^+03
  2.9898*10^+03
  2.9905*10^+03
  2.9911*10^+03
  2.9916*10^+03
  2.9921*10^+03
  2.9926*10^+03
  2.9930*10^+03]./9.81;

Isv1 =[  2.0431*10^+03
  2.0455*10^+03
  2.0475*10^+03
  2.0492*10^+03
  2.0507*10^+03
  2.0521*10^+03
  2.0534*10^+03
  2.0545*10^+03
  2.0556*10^+03
  2.0565*10^+03
  2.0574*10^+03
  2.0582*10^+03
  2.0590*10^+03
  2.0598*10^+03
  2.0605*10^+03]./9.81;
Isv2 = [  3.1573*10^+03
  3.1586*10^+03
  3.1597*10^+03
  3.1606*10^+03
  3.1614*10^+03
  3.1622*10^+03
  3.1628*10^+03
  3.1634*10^+03
  3.1639*10^+03
  3.1644*10^+03
  3.1649*10^+03
  3.1653*10^+03
  3.1657*10^+03
  3.1660*10^+03
  3.1664*10^+03]./9.81;

Me3 = [  3.7498*10^+00
  3.7547*10^+00
  3.7589*10^+00
  3.7625*10^+00
  3.7656*10^+00
  3.7684*10^+00
  3.7709*10^+00
  3.7731*10^+00
  3.7752*10^+00
  3.7771*10^+00
  3.7789*10^+00
  3.7805*10^+00
  3.7820*10^+00
  3.7834*10^+00
  3.7847*10^+00];

son1 = [  1.1415*10^+03
  1.1429*10^+03
  1.1440*10^+03
  1.1450*10^+03
  1.1458*10^+03
  1.1466*10^+03
  1.1473*10^+03
  1.1480*10^+03
  1.1485*10^+03
  1.1491*10^+03
  1.1496*10^+03
  1.1501*10^+03
  1.1505*10^+03
  1.1509*10^+03
  1.1513*10^+03];
son2 = [  1.0945*10^+03
  1.0958*10^+03
  1.0970*10^+03
  1.0980*10^+03
  1.0989*10^+03
  1.0997*10^+03
  1.1004*10^+03
  1.1011*10^+03
  1.1017*10^+03
  1.1022*10^+03
  1.1028*10^+03
  1.1032*10^+03
  1.1037*10^+03
  1.1041*10^+03
  1.1045*10^+03];
son3 = [  7.2468*10^+02
  7.2635*10^+02
  7.2778*10^+02
  7.2902*10^+02
  7.3012*10^+02
  7.3112*10^+02
  7.3201*10^+02
  7.3283*10^+02
  7.3358*10^+02
  7.3428*10^+02
  7.3493*10^+02
  7.3553*10^+02
  7.3610*10^+02
  7.3663*10^+02
  7.3714*10^+02];

rho1 = [  2.7155*10^+00
  3.1598*10^+00
  3.6031*10^+00
  4.0456*10^+00
  4.4874*10^+00
  4.9285*10^+00
  5.3690*10^+00
  5.8090*10^+00
  6.2485*10^+00
  6.6876*10^+00
  7.1262*10^+00
  7.5645*10^+00
  8.0025*10^+00
  8.4401*10^+00
  8.8774*10^+00];
rho2 = [  1.6816*10^+00
  1.9567*10^+00
  2.2311*10^+00
  2.5051*10^+00
  2.7785*10^+00
  3.0516*10^+00
  3.3243*10^+00
  3.5967*10^+00
  3.8687*10^+00
  4.1405*10^+00
  4.4120*10^+00
  4.6833*10^+00
  4.9544*10^+00
  5.2253*10^+00
  5.4959*10^+00];
rho3 = [  2.4224*10^-02
  2.8175*10^-02
  3.2117*10^-02
  3.6050*10^-02
  3.9976*10^-02
  4.3895*10^-02
  4.7808*10^-02
  5.1715*10^-02
  5.5618*10^-02
  5.9516*10^-02
  6.3409*10^-02
  6.7299*10^-02
  7.1185*10^-02
  7.5068*10^-02
  7.8948*10^-02];

cf2 = [  6.5182*10^-01
  6.5210*10^-01
  6.5234*10^-01
  6.5256*10^-01
  6.5275*10^-01
  6.5292*10^-01
  6.5308*10^-01
  6.5323*10^-01
  6.5336*10^-01
  6.5349*10^-01
  6.5361*10^-01
  6.5372*10^-01
  6.5382*10^-01
  6.5392*10^-01
  6.5402*10^-01];
cf3 = [  1.7968*10^+00
  1.7959*10^+00
  1.7951*10^+00
  1.7944*10^+00
  1.7938*10^+00
  1.7933*10^+00
  1.7928*10^+00
  1.7923*10^+00
  1.7919*10^+00
  1.7915*10^+00
  1.7912*10^+00
  1.7908*10^+00
  1.7905*10^+00
  1.7902*10^+00
  1.7899*10^+00];

cstar2 = [1659.2 1661.0 1662.5 1663.8 1665.0 1666.0 1666.9 1667.8 1668.5 1669.2 1669.9 1670.5 1671.1 1671.6 1672.1];
%% Grafici: Tutto in funzione di Pc con O/F = 6.9
Ae = 26.5;
Pc = [30:5:100];

Is = [Is1'; Is2'];
Isv = [Isv1'; Isv2'];

Tc = [Tc1'; Tc2'; Tc3'];

cf = [zeros(1,15); cf2'; cf3'];
cstar = [zeros(1,15); cstar2; cstar2];
Me = [zeros(1,15); ones(1,15); Me3'];
son = [son1'; son2'; son3'];
rho = [rho1'; rho2'; rho3'];

ve2 = ones(1,15).*son2;
mpunto2 = Ae.*rho2.*ve2; 
T2 = cf2'*cstar2'*mpunto2'; 

ve3 = Me3.*son3;
mpunto3 = Ae.*rho3.*ve3; 
T3 = cf3'*cstar2'*mpunto3'; 

%phi = [];

subplot(1,3,1)
hold on;
grid on;
plot(Pc,Is2);
plot(Pc,Isv2);
legend("b","c","bv","cv");


subplot(1,3,2)
hold on;
grid on;
plot(Pc,(Tc3));
%plot(Pc,Tc2);
%plot(Pc,Tc3);
legend("chamber","throat","exit");

subplot(1,3,3)
hold on;
grid on;
%plot(Pc,T2');
plot(Pc,log(T3'));
legend("throat","exit");


%% 
a = [];
for i = 1:15
    A = log(T3(i));
    i = i + 1;
    a = [a A];
end
figure (5)
hold on;
plot(Pc,log(T3));
plot(Pc,log(Tc3));
plot(Pc,log(Is2));
plot(Pc,log(Isv2));

legend("T","Tc","Is","Isv");